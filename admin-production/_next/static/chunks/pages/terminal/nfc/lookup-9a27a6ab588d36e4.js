(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3500],{7653:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(4297).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},3756:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(4297).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},7669:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(4297).Z)("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]])},9461:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(4297).Z)("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]])},5094:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/terminal/nfc/lookup",function(){return s(3805)}])},3805:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var r=s(5893),a=s(7294),n=s(4698),i=s(8126);class c{checkSupport(){"NDEFReader"in window?(this.isSupported=!0,console.log("Web NFC API is supported")):(this.isSupported=!1,console.log("Web NFC API is not supported"))}isNFCSupported(){return this.isSupported}async startReading(){if(!this.isSupported)throw Error("Web NFC API is not supported");if(this.isReading)throw Error("NFC reading is already in progress");try{this.reader=new window.NDEFReader,await this.reader.scan(),this.isReading=!0,console.log("NFC reading started")}catch(e){throw console.error("Failed to start NFC reading:",e),e}}stopReading(){this.reader&&(this.reader.destroy(),this.reader=null,this.isReading=!1,console.log("NFC reading stopped"))}isCurrentlyReading(){return this.isReading}onReading(e){this.reader&&this.reader.addEventListener("reading",e)}onReadingError(e){this.reader&&this.reader.addEventListener("readingerror",e)}async writeNFC(e){if(!this.isSupported)throw Error("Web NFC API is not supported");try{let t=new window.NDEFReader;await t.write({records:"string"==typeof e?[{recordType:"text",data:e}]:e}),console.log("NFC write completed")}catch(e){throw console.error("Failed to write NFC:",e),e}}extractTextFromMessage(e){for(let t of e.records)if("text"===t.recordType)return new TextDecoder().decode(t.data);return null}extractURLFromMessage(e){for(let t of e.records)if("url"===t.recordType)return new TextDecoder().decode(t.data);return null}formatSerialNumber(e){return e.replace(/:/g,"").toUpperCase()}getTagInfo(e){return{uid:this.formatSerialNumber(e.serialNumber),textData:this.extractTextFromMessage(e.message),urlData:this.extractURLFromMessage(e.message),allRecords:e.message.records}}mockNFCRead(e,t){this.isSupported||console.log("Mock NFC Read - Real NFC not supported");let s=new CustomEvent("nfc-mock-read",{detail:{uid:e,textData:t||"",timestamp:new Date().toISOString()}});window.dispatchEvent(s)}async requestPermission(){if(!this.isSupported)throw Error("Web NFC API is not supported");try{return(await navigator.permissions.query({name:"nfc"})).state}catch(e){throw console.error("Failed to request NFC permission:",e),e}}constructor(){this.reader=null,this.isSupported=!1,this.isReading=!1,this.checkSupport()}}let l=new c;var d=s(666),o=s(7029),x=s(1962),u=s(9455),m=s(7653),h=s(3756),p=s(3546),N=s(9461),g=s(6383),f=s(4933),y=s(7669),j=s(1163),b=()=>{let e=(0,j.useRouter)(),[t,s]=(0,a.useState)(!1),[c,b]=(0,a.useState)(null),[w,C]=(0,a.useState)(null),[v,F]=(0,a.useState)(""),[k,R]=(0,a.useState)(!1),[S,E]=(0,a.useState)(null),[Z,D]=(0,a.useState)(!1);(0,a.useEffect)(()=>{R(l.isNFCSupported()),l.isNFCSupported()&&l.requestPermission().then(e=>E(e)).catch(e=>console.error("NFC permission check failed:",e));let e=e=>{let{uid:t,textData:s}=e.detail;I(t)};return window.addEventListener("nfc-mock-read",e),()=>{window.removeEventListener("nfc-mock-read",e),l.isCurrentlyReading()&&l.stopReading()}},[]);let _=async()=>{if(!k){C({type:"error",text:"このブラウザはNFC機能をサポートしていません。手動でUIDを入力してください。"});return}try{s(!0),C({type:"info",text:"NFCカードをスマートフォンに近づけてください..."}),await l.startReading(),l.onReading(e=>{let t=l.getTagInfo(e);console.log("NFC Tag detected:",t);let r=t.textData||t.uid;I(r),s(!1),l.stopReading()}),l.onReadingError(e=>{console.error("NFC reading error:",e),C({type:"error",text:"NFCスキャンでエラーが発生しました"}),s(!1)}),setTimeout(()=>{if(t){let e="TEST_"+Math.random().toString(36).substr(2,3).toUpperCase();l.mockNFCRead(e,"Mock NFC Data: ".concat(e))}},5e3)}catch(e){console.error("NFC scan error:",e),C({type:"error",text:"NFC機能の開始に失敗しました"}),s(!1)}},I=async e=>{try{let t=await i.E.lookupUserByNFC(e);if(t.success&&t.user){let s=t.user;b({id:s.id,name:"".concat(s.first_name||""," ").concat(s.last_name||"").trim()||s.username,email:s.email,currentPoints:s.points||0,memberSince:s.date_joined?new Date(s.date_joined).toLocaleDateString("ja-JP"):"Unknown",uid:e}),C({type:"success",text:"ユーザーが見つかりました！"})}else C({type:"error",text:t.error||"ユーザーが見つかりませんでした"}),b(null)}catch(e){C({type:"error",text:"ユーザーが見つかりませんでした"}),b(null)}},T=async()=>{if(!v.trim()){C({type:"error",text:"UIDを入力してください"});return}await I(v)};return(0,r.jsx)(n.Z,{title:"NFC読取",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,r.jsxs)("div",{className:"card-cute text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-400 to-cyan-500 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(x.Z,{className:"w-8 h-8 text-white"})}),(0,r.jsx)("h1",{className:"text-3xl font-bold gradient-text mb-2",children:"NFC読取"}),(0,r.jsx)("p",{className:"text-gray-600",children:"NFCカードからユーザー情報を読み取ります"})]}),(0,r.jsx)("div",{className:"card-cute bg-gradient-to-r from-blue-50 to-cyan-50",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(k?"bg-green-100":"bg-gray-100"),children:k?(0,r.jsx)(u.Z,{className:"w-5 h-5 text-green-600"}):(0,r.jsx)(m.Z,{className:"w-5 h-5 text-gray-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-gray-800",children:"NFC機能"}),(0,r.jsx)("p",{className:"text-sm ".concat(k?"text-green-600":"text-gray-500"),children:k?"利用可能":"利用不可"})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"権限"}),(0,r.jsx)("p",{className:"text-sm font-semibold ".concat("granted"===S?"text-green-600":"denied"===S?"text-red-600":"text-yellow-600"),children:"granted"===S?"許可済み":"denied"===S?"拒否":"未確認"})]})]})}),w&&(0,r.jsxs)("div",{className:"p-4 rounded-2xl flex items-center space-x-3 ".concat("success"===w.type?"bg-green-50 border border-green-200":"error"===w.type?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200"),children:["success"===w.type?(0,r.jsx)(h.Z,{className:"w-5 h-5 text-green-600"}):"error"===w.type?(0,r.jsx)(m.Z,{className:"w-5 h-5 text-red-600"}):(0,r.jsx)(p.Z,{className:"w-5 h-5 text-blue-600"}),(0,r.jsx)("span",{className:"font-medium ".concat("success"===w.type?"text-green-700":"error"===w.type?"text-red-700":"text-blue-700"),children:w.text})]}),(0,r.jsxs)("div",{className:"card-cute",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"NFCスキャン"}),(0,r.jsx)("div",{className:"text-center",children:t?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-32 h-32 bg-gradient-to-r from-blue-400 to-cyan-500 rounded-full flex items-center justify-center mx-auto animate-pulse",children:(0,r.jsx)(p.Z,{className:"w-16 h-16 text-white"})}),(0,r.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-blue-300 animate-ping"})]}),(0,r.jsx)("p",{className:"text-lg font-semibold text-gray-800",children:"スキャン中..."}),(0,r.jsx)("p",{className:"text-gray-600",children:"NFCカードをデバイスに近づけてください"}),(0,r.jsx)("button",{onClick:()=>{s(!1),C(null),l.isCurrentlyReading()&&l.stopReading()},className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-2xl font-semibold hover:bg-gray-50 transition-colors duration-200",children:"キャンセル"})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"w-32 h-32 bg-gradient-to-r from-blue-100 to-cyan-100 rounded-full flex items-center justify-center mx-auto",children:(0,r.jsx)(x.Z,{className:"w-16 h-16 text-blue-600"})}),(0,r.jsxs)("div",{className:"flex space-x-4 justify-center",children:[(0,r.jsxs)("button",{onClick:_,className:"btn-primary flex items-center space-x-2",children:[(0,r.jsx)(N.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"NFCスキャン"})]}),(0,r.jsxs)("button",{onClick:()=>D(!0),className:"btn-secondary flex items-center space-x-2",children:[(0,r.jsx)(g.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"QRスキャン"})]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"※ NFC機能が利用できない場合は、下記の手動入力をご利用ください"})]})})]}),(0,r.jsxs)("div",{className:"card-cute",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"手動UID入力"}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("input",{type:"text",value:v,onChange:e=>F(e.target.value),className:"flex-1 input-cute",placeholder:"UID または会員番号を入力"}),(0,r.jsx)("button",{onClick:T,className:"btn-secondary whitespace-nowrap",children:"検索"})]})]}),c&&(0,r.jsxs)("div",{className:"card-cute border-l-4 border-green-400",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-green-400 to-emerald-500 rounded-full flex items-center justify-center",children:(0,r.jsx)(f.Z,{className:"w-8 h-8 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xl font-bold text-gray-800",children:c.name}),(0,r.jsx)("p",{className:"text-gray-600",children:c.email}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,r.jsxs)("span",{className:"text-sm bg-green-100 text-green-700 px-3 py-1 rounded-full",children:["現在のポイント: ",c.currentPoints.toLocaleString()," pt"]}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["UID: ",c.uid]})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["会員登録: ",c.memberSince]})]})]})}),(0,r.jsxs)("div",{className:"flex space-x-3 mt-6",children:[(0,r.jsx)("button",{onClick:()=>{b(null),F(""),C(null)},className:"flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-2xl font-semibold hover:bg-gray-50 transition-colors duration-200",children:"リセット"}),(0,r.jsxs)("button",{onClick:()=>{c&&e.push("/points/grant?uid=".concat(c.uid,"&name=").concat(encodeURIComponent(c.name)))},className:"flex-1 btn-primary flex items-center justify-center space-x-2",children:[(0,r.jsx)(y.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"ポイント付与へ"})]})]})]}),(0,r.jsxs)("div",{className:"card-cute bg-gradient-to-r from-purple-50 to-pink-50",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"使用方法"}),(0,r.jsxs)("div",{className:"space-y-3 text-sm text-gray-600",children:[(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("div",{className:"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,r.jsx)("span",{className:"text-primary-600 font-bold text-xs",children:"1"})}),(0,r.jsx)("p",{children:"「NFCスキャン」または「QRスキャン」ボタンを押してスキャンモードを開始します"})]}),(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("div",{className:"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,r.jsx)("span",{className:"text-primary-600 font-bold text-xs",children:"2"})}),(0,r.jsx)("p",{children:"お客様のNFCカードをスマートフォンに近づけるか、QRコードをカメラで読み取ります"})]}),(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("div",{className:"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,r.jsx)("span",{className:"text-primary-600 font-bold text-xs",children:"3"})}),(0,r.jsx)("p",{children:"ユーザー情報が表示されたら「ポイント付与へ」ボタンでポイント付与画面に移動します"})]})]})]}),(0,r.jsx)(d.Z,{isActive:Z,onScan:e=>{D(!1);let t=o.F.extractUID(e.data);t?(C({type:"success",text:"QRコードからUID「".concat(t,"」を検出しました")}),I(t)):(C({type:"info",text:"QRコードデータ: ".concat(e.data)}),I(e.data))},onError:e=>{C({type:"error",text:e})},onClose:()=>D(!1)})]})})}}},function(e){e.O(0,[7066,4862,3401,255,4698,1047,9774,2888,179],function(){return e(e.s=5094)}),_N_E=e.O()}]);